<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Oil Finder | Castrol Classic</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #004121;
            --secondary-color: #EFECEC;
            --accent-color: #FF4400;
            --text-color: #333333;
            --border-color: #cccccc;
            --success-color: #4CAF50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        /* Header Styles */
        header {
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            text-align: center;
            padding: 10px 0;
        }

        .logo img {
            height: 90px;
        }

        .header-icons a {
            margin-left: 15px;
            color: var(--primary-color);
            font-size: 1.2rem;
            text-decoration: none;
        }

        nav {
            background-color: var(--primary-color);
            padding: 10px 0;
        }

        .nav-container {
            display: flex;
            justify-content: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-container a {
            color: white;
            text-decoration: none;
            padding: 0 15px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-container a:hover {
            text-decoration: underline;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Main Content Styles */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            margin: 20px 0;
            font-size: 2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Search Section */
        .search-section {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .search-title {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        #search-container {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }

        #search-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 16px;
            transition: border 0.3s;
        }

        #search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 65, 33, 0.2);
        }

        #search-button {
            position: absolute;
            right: 5px;
            top: 5px;
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #search-button:hover {
            background-color: #003018;
        }

        #suggestions-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 4px 4px;
            z-index: 10;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .suggestion-header {
            background-color: var(--secondary-color);
            padding: 8px 15px;
            font-weight: bold;
            color: var(--primary-color);
            border-bottom: 1px solid var(--border-color);
        }

        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover {
            background-color: #f5f5f5;
        }

        .make-suggestion::before {
            content: '\f1b9';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            margin-right: 8px;
            color: var(--primary-color);
        }

        .model-suggestion::before {
            content: '\f085';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            margin-right: 8px;
            color: var(--primary-color);
        }

        /* Brands Grid Section */
        .brands-section {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .brands-title {
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        #make-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .make-item {
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .make-item:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* Results Section */
        .results-section {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .results-title {
            margin-bottom: 20px;
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        #results-area {
            background-color: var(--secondary-color);
            padding: 20px;
            border-radius: 4px;
            line-height: 1.7;
        }

        .result-item {
            background-color: white;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .result-item h2 {
            color: var(--primary-color);
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--primary-color);
        }

        .result-item h3 {
            margin: 15px 0 10px;
            color: #555;
        }

        .result-item p {
            margin: 8px 0;
        }

        .result-item a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
        }

        .result-item a:hover {
            text-decoration: underline;
        }

        .error {
            color: red;
            font-weight: bold;
        }

        /* Footer Styles */
        footer {
            background-color: var(--primary-color);
            color: white;
            padding: 40px 0 20px;
            margin-top: 30px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
        }

        .footer-column h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 10px;
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column li {
            margin-bottom: 8px;
        }

        .footer-column a {
            color: white;
            text-decoration: none;
            transition: opacity 0.3s;
        }

        .footer-column a:hover {
            opacity: 0.8;
        }

        .social-icons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .social-icons a {
            display: inline-block;
            width: 36px;
            height: 36px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 50%;
            text-align: center;
            line-height: 36px;
            transition: background-color 0.3s;
        }

        .social-icons a:hover {
            background-color: rgba(255,255,255,0.2);
        }

        .copyright {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .header-top {
                padding: 10px;
            }

            .logo img {
                height: 40px;
            }

            .nav-container {
                display: none;
                flex-direction: column;
                padding: 10px;
            }

            .nav-container.active {
                display: flex;
            }

            .nav-container a {
                padding: 10px 0;
                text-align: center;
                border-bottom: 1px solid rgba(255,255,255,0.1);
            }

            .mobile-menu-btn {
                display: block;
            }

            .search-section,
            .brands-section,
            .results-section {
                padding: 20px 15px;
            }

            #make-list {
                grid-template-columns: repeat(2, 1fr);
            }

            .footer-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .footer-column {
                text-align: center;
            }

            .social-icons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-top">
            <div class="search-icon">
            </div>
            <div class="logo">
                <img src="https://cdn.shopify.com/s/files/1/0623/1326/7245/files/Logo_2.png?v=1716933488" alt="Castrol Classic Logo">
            </div>
            <div class="header-icons">
                <button class="mobile-menu-btn"><i class="fas fa-bars"></i></button>
            </div>
        </div>
        <nav>
            <div class="nav-container">
                <a href="https://www.castrolclassic.co.za/">Shop</a>
                <a href="https://www.castrolclassic.co.za/collections/motor-oil">Oils</a>
                <a href="https://www.castrolclassic.co.za/collections/brake-fluid">Fluids & Greases</a>
                <a href="https://www.castrolclassic.co.za/collections/merch">Merch</a>
                <a href="https://www.castrolclassic.co.za/products/castrol-classic-oil">Gift Cards</a>
                <a href="https://www.castrolclassic.co.za/pages/heritage">History</a>
                <a href="https://www.castrolclassic.co.za/pages/contact-us-1">Contact</a>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <div class="container">
        <h1>Castrol Classic Online Oil Finder</h1>

        <!-- Search Section -->
        <section class="search-section">
            <h2 class="search-title">Discover the Castrol Classic lubricant your vehicle deserves.</h2>
            <div id="search-container">
                <input type="text" id="search-input" placeholder="Enter car make and model">
                <button id="search-button">Search</button>
                <div id="suggestions-list"></div>
            </div>
        </section>

        <!-- Brands Grid Section -->
        <section class="brands-section">
            <h2 class="brands-title">Iconic Makes</h2>
            <div id="make-list">
                <!-- Car makes will be inserted here by JavaScript -->
            </div>
        </section>

        <!-- Results Section -->
        <section class="results-section">
            <h2 class="results-title">Results</h2>
            <div id="results-area">
                <p>Enter a car make and model to find oil information.</p>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-column">
                <h3>Shop</h3>
                <ul>
                    <li><a href="https://www.castrolclassic.co.za/collections/motor-oil">Engine/Motor Oil</a></li>
                    <li><a href="https://www.castrolclassic.co.za/collections/gear-oil">Transmission/Gear Box Oils</a></li>
                    <li><a href="https://www.castrolclassic.co.za/collections/brake-fluid">Brake Fluids</a></li>
                    <li><a href="https://www.castrolclassic.co.za/collections/additives">Fuel Additives/Lead Replacement</a></li>
                    <li><a href="https://www.castrolclassic.co.za/collections/greases">Grease</a></li>
                    <li><a href="https://www.castrolclassic.co.za/collections/coolant">Coolant/Anti Freeza</a></li>
                    <li><a href="https://www.castrolclassic.co.za/collections/merch">Merch/Tools</a></li>


                </ul>
            </div>
            <div class="footer-column">
                <h3>Information</h3>
                <ul>
                    <li><a href="https://www.castrolclassic.co.za/policies/refund-policy">Refund policy</a></li>
                    <li><a href="https://www.castrolclassic.co.za/policies/privacy-policy">Privacy policy</a></li>
                    <li><a href="https://www.castrolclassic.co.za/policies/shipping-policy">Shipping policy</a></li>
                    <li><a href="https://www.castrolclassic.co.za/policies/contact-information">Contact information</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Contact Us</h3>
                <ul>
                    <li>Call/WhatsApp: +27 79 744 0031</li>
                    <li>Email: info@castrolclassic.co.za</li>
                    <li>
                        <div class="social-icons">
                            <a href="https://www.facebook.com/imoilssa"><i class="fab fa-facebook-f"></i></a>
                            <a href="https://www.instagram.com/castrolclassic/"><i class="fab fa-instagram"></i></a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            &copy; 2025 Castrol Classic Online. All rights reserved.
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Mobile menu toggle
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            const navContainer = document.querySelector('.nav-container');

            mobileMenuBtn.addEventListener('click', () => {
                navContainer.classList.toggle('active');
            });

            // Define elements
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const resultsArea = document.getElementById('results-area');
            const suggestionsList = document.getElementById('suggestions-list');
            const makeList = document.getElementById('make-list');

            // Fetch makes from the server and populate the grid
            async function fetchMakes() {
                try {
                    // This assumes your Flask server is returning the makes
                    // You might need to create a specific endpoint for this
                    const response = await fetch('/api/makes');
                    if (!response.ok) {
                        // If the endpoint doesn't exist, we'll use some dummy data
                        populateMakesGrid([
                            'ALFA ROMEO', 'ASTON MARTIN', 'AUDI', 'BENTLEY', 'BMW',
                            'BUGATTI', 'CADILLAC', 'CHEVROLET', 'CHRYSLER', 'CITROEN',
                            'DACIA', 'DAEWOO', 'DAIHATSU', 'DODGE', 'FERRARI', 'FIAT',
                            'FORD', 'HONDA', 'HUMMER', 'HYUNDAI', 'INFINITI', 'JAGUAR',
                            'JEEP', 'KIA', 'LAMBORGHINI', 'LAND ROVER', 'LEXUS', 'LOTUS',
                            'MASERATI', 'MAZDA', 'MERCEDES BENZ', 'MINI', 'MITSUBISHI',
                            'NISSAN', 'OPEL', 'PEUGEOT', 'PORSCHE', 'RENAULT', 'ROLLS ROYCE',
                            'SAAB', 'SEAT', 'SKODA', 'SMART', 'SUBARU', 'SUZUKI', 'TESLA',
                            'TOYOTA', 'VOLKSWAGEN', 'VOLVO'
                        ]);
                        return;
                    }
                    const data = await response.json();
                    populateMakesGrid(data);
                } catch (error) {
                    console.error('Error fetching makes:', error);
                    // Use dummy data if fetch fails
                    populateMakesGrid([
                        'ALFA ROMEO', 'ASTON MARTIN', 'AUDI', 'BENTLEY', 'BMW',
                        'BUGATTI', 'CADILLAC', 'CHEVROLET', 'CHRYSLER', 'CITROEN',
                        'DACIA', 'DAEWOO', 'DAIHATSU', 'DODGE', 'FERRARI', 'FIAT',
                        'FORD', 'HONDA', 'HUMMER', 'HYUNDAI', 'INFINITI', 'JAGUAR',
                        'JEEP', 'KIA', 'LAMBORGHINI', 'LAND ROVER', 'LEXUS', 'LOTUS',
                        'MASERATI', 'MAZDA', 'MERCEDES BENZ', 'MINI', 'MITSUBISHI',
                        'NISSAN', 'OPEL', 'PEUGEOT', 'PORSCHE', 'RENAULT', 'ROLLS ROYCE',
                        'SAAB', 'SEAT', 'SKODA', 'SMART', 'SUBARU', 'SUZUKI', 'TESLA',
                        'TOYOTA', 'VOLKSWAGEN', 'VOLVO'
                    ]);
                }
            }

            // Populate makes grid
            function populateMakesGrid(makes) {
                makeList.innerHTML = '';
                makes.forEach(make => {
                    const makeItem = document.createElement('div');
                    makeItem.classList.add('make-item');
                    makeItem.textContent = make;
                    makeItem.addEventListener('click', () => {
                        searchInput.value = make;
                        performSearch(make);
                    });
                    makeList.appendChild(makeItem);
                });
            }

            // Display search results
            function displayResults(results) {
                resultsArea.innerHTML = ''; // Clear previous results

                if (results && results.length > 0) {
                    const displayedMakes = new Set(); // To track displayed makes

                    results.forEach(result => {
                        const resultDiv = document.createElement('div');
                        resultDiv.classList.add('result-item');

                        if (result.model_year_text) {
                            const make = result.model_year_text.split(' ')[0]; // Extract the first word (make)
                            if (make && !displayedMakes.has(make)) {
                                const makeHeader = document.createElement('h2');
                                makeHeader.textContent = make;
                                resultDiv.appendChild(makeHeader);
                                displayedMakes.add(make);
                            }
                            const h3 = document.createElement('h3');
                            h3.textContent = result.model_year_text;
                            resultDiv.appendChild(h3);
                        }

                        const createDetailRow = (label, value, link = null) => {
                            if (!value) return;

                            const p = document.createElement('p');
                            p.innerHTML = `<strong>${label}:</strong> `;

                            if (link) {
                                const a = document.createElement('a');
                                a.href = link;
                                a.textContent = value;
                                a.target = "_blank";
                                a.rel = "noopener noreferrer";
                                p.appendChild(a);
                            } else {
                                p.appendChild(document.createTextNode(value));
                            }
                            resultDiv.appendChild(p);
                        };

                        // Add details
                        if (result.engine_oil) createDetailRow('Engine Oil', result.engine_oil, result.engine_oil_link);
                        if (result.gearbox_oil) createDetailRow('Gearbox Oil', result.gearbox_oil, result.gearbox_oil_link);
                        if (result.rear_axle_oil) createDetailRow('Rear Axle Oil', result.rear_axle_oil, result.rear_axle_oil_link);

                        resultsArea.appendChild(resultDiv);
                    });
                } else {
                    resultsArea.innerHTML = '<p>No results found. Please try a more specific search.</p>';
                }
            }

            // Perform search
            async function performSearch(query) {
                try {
                    // Show loading indicator
                    resultsArea.innerHTML = '<p>Searching for oil information...</p>';

                    const response = await fetch('/api/details', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ query: query })
                    });

                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();

                    // Scroll to results
                    document.querySelector('.results-section').scrollIntoView({ behavior: 'smooth' });

                    displayResults(data);
                } catch (error) {
                    console.error('Search error:', error);
                    resultsArea.innerHTML = `<p class="error">Search failed: ${error.message}</p>`;
                }
            }

            // Get suggestions
            async function getSuggestions(query) {
                try {
                    const response = await fetch(`/api/suggest/${encodeURIComponent(query)}`);
                    if (!response.ok) throw new Error(`HTTP error fetching suggestions! status: ${response.status}`);
                    const data = await response.json();
                    displaySuggestions(data);
                } catch (error) {
                    console.error('Error fetching suggestions:', error);
                    suggestionsList.innerHTML = '';
                }
            }

            // Display suggestions
            function displaySuggestions(suggestions) {
                suggestionsList.innerHTML = '';

                if (suggestions && (suggestions.makes.length > 0 || suggestions.models.length > 0)) {
                    if (suggestions.makes.length > 0) {
                        const makeHeader = document.createElement('div');
                        makeHeader.classList.add('suggestion-header');
                        makeHeader.textContent = 'Makes';
                        suggestionsList.appendChild(makeHeader);

                        suggestions.makes.forEach(suggestion => {
                            const suggestionItem = document.createElement('div');
                            suggestionItem.classList.add('suggestion-item', 'make-suggestion');
                            suggestionItem.textContent = suggestion;
                            suggestionItem.addEventListener('click', () => {
                                searchInput.value = suggestion;
                                suggestionsList.innerHTML = '';
                                searchInput.focus();
                                performSearch(suggestion);
                            });
                            suggestionsList.appendChild(suggestionItem);
                        });
                    }

                    if (suggestions.models.length > 0) {
                        const modelHeader = document.createElement('div');
                        modelHeader.classList.add('suggestion-header');
                        modelHeader.textContent = 'Models';
                        suggestionsList.appendChild(modelHeader);

                        suggestions.models.forEach(suggestion => {
                            const suggestionItem = document.createElement('div');
                            suggestionItem.classList.add('suggestion-item', 'model-suggestion');
                            suggestionItem.textContent = suggestion;
                            suggestionItem.addEventListener('click', () => {
                                searchInput.value = suggestion;
                                suggestionsList.innerHTML = '';
                                searchInput.focus();
                                performSearch(suggestion);
                            });
                            suggestionsList.appendChild(suggestionItem);
                        });
                    }
                }
            }

            // Event listeners
            searchButton.addEventListener('click', () => {
                const query = searchInput.value.trim();
                if (query) {
                    performSearch(query);
                } else {
                    resultsArea.innerHTML = '<p>Please enter a car make and model to search.</p>';
                }
            });

            let debounceTimer;
            searchInput.addEventListener('input', () => {
                const query = searchInput.value.trim();
                clearTimeout(debounceTimer);

                if (query.length >= 2) { // Reduced from 3 to 2 for quicker suggestions
                    debounceTimer = setTimeout(() => {
                        getSuggestions(query);
                    }, 300); // Debounce: Wait 300ms after typing
                } else {
                    suggestionsList.innerHTML = '';
                }
            });

            // Close suggestions when clicking outside
            document.addEventListener('click', (e) => {
                if (!searchInput.contains(e.target) && !suggestionsList.contains(e.target)) {
                    suggestionsList.innerHTML = '';
                }
            });

            // Add search submit on enter
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const query = searchInput.value.trim();
                    if (query) {
                        performSearch(query);
                    }
                }
            });

            // Initialize
            fetchMakes();
        });
    </script>
</body>
</html>